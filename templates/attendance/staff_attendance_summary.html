{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <h1 class="mb-3">{{ title }} ({{ month }}/{{ year }})</h1>

  <!-- Filter Form -->
  <form method="get" class="row g-2 align-items-end mb-4">
    <div class="col-auto">
      <label for="month" class="form-label">Month</label>
      <input
        type="number"
        id="month"
        name="month"
        class="form-control"
        min="1"
        max="12"
        value="{{ month }}"
      >
    </div>
    <div class="col-auto">
      <label for="year" class="form-label">Year</label>
      <input
        type="number"
        id="year"
        name="year"
        class="form-control"
        min="2000"
        max="2100"
        value="{{ year }}"
      >
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-primary">Filter</button>
    </div>
  </form>

  <!-- Export Buttons -->
  <div class="mb-3 d-flex justify-content-end gap-2">
    <a href="{% url 'export_staff_attendance_summary_pdf' %}?month={{ month }}&year={{ year }}" class="btn btn-outline-danger btn-sm">⬇️ Export PDF</a>
    <a href="{% url 'export_staff_attendance_excel' %}" class="btn btn-outline-success btn-sm">⬇️ Export Excel</a>
  </div>

  <!-- Summary Table -->
  <table class="table table-bordered table-striped">
    <thead class="table-light">
      <tr>
        <th>Department / Role</th>
        <th class="text-center">Present</th>
        <th class="text-center">Absent</th>
        <th class="text-center">Leave</th>
        <th class="text-center">Total</th>
      </tr>
    </thead>
    <tbody>
      {% for row in summary %}
      <tr>
        <td>{{ row.staff__department }} / {{ row.staff__staff_role|default:"—" }}</td>
        <td class="text-center">{{ row.present }}</td>
        <td class="text-center">{{ row.absent }}</td>
        <td class="text-center">{{ row.leave }}</td>
        <td class="text-center">{{ row.total }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" class="text-center">No records found for this period.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

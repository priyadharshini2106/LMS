{% extends 'base.html' %}
{% load static %}
{% block title %}{% if view.object %}Edit Allocation{% else %}New Allocation{% endif %}{% endblock %}

{% block content %}
<style>
  html, body { height: 100%; }
  body { background: transparent !important; }
  body::before{
    content:""; position: fixed; inset: 0;
    background: url("{% static 'images/bg-wave.png' %}") center/cover no-repeat fixed;
    z-index: -1;
  }

  :root{
    --lav-strong:#7c3aed;
    --ink:#14121a;
    --muted:#3f3f46;
  }

  .form-shell{ max-width: 800px; margin: 22px auto 32px; padding: 0 18px; }
  .page-title{ font-weight: 800; font-size: 2rem; color: var(--ink); display:flex; gap:.55rem; margin-bottom: 14px; }

  .form-pane{
    background: rgba(255,255,255,.70);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    border: 1px solid rgba(233,213,255,.55);
    border-radius: 14px;
    box-shadow: 0 10px 28px rgba(124,58,237,.12);
    padding: 22px;
  }

  .field{ margin-bottom: 18px; }
  .field label{
    display:block;
    font-weight:800;
    color:var(--muted);
    margin: 2px 0 6px 2px;
  }

  .field input,
  .field select,
  .field textarea{
    width:100%;
    background: transparent;
    border:none;
    border-bottom: 2px solid rgba(0,0,0,.18);
    padding: 10px 6px 8px 2px;
    font-size: 1.06rem;
    color: var(--ink);
    outline: none;
    transition: border-color .15s ease, background .15s ease, box-shadow .15s ease;
    border-radius: 8px;
  }
  .field input:focus, .field select:focus, .field textarea:focus{
    border-bottom-color: var(--lav-strong);
    background: rgba(255,255,255,.25);
    box-shadow: 0 8px 24px rgba(124,58,237,.10);
  }

  .form-text{ font-size:.85rem; color:#6b7280; margin-top:4px; }
  .errorlist, .field .error{ list-style:none; margin:.35rem 0 0; padding:0; color:#b91c1c; font-weight:700; font-size:.92rem; }

  .actions{ margin-top: 22px; display:flex; gap: 12px; justify-content:center; flex-wrap:wrap; }
  .btnx{ display:inline-block; padding:.9rem 1.6rem; border-radius:14px; font-weight:800; text-decoration:none !important; border:1px solid transparent; transition: all .18s ease; }
  .btn-primaryx{ background: linear-gradient(135deg,#a78bfa,#7c3aed); color:#fff; box-shadow: 0 10px 22px rgba(124,58,237,.22); }
  .btn-primaryx:hover{ background:#5b21b6; color:#fff; transform: translateY(-1px); }
  .btn-cancelx{ background:#fff; color:#6b7280; border:1px solid rgba(0,0,0,.12); }
  .btn-cancelx:hover{ background:#fee2e2; color:#991b1b; border-color:#fecaca; }

  .alert-danger{
    background:#fee2e2; border:1px solid #fecaca; color:#991b1b;
    padding:.75rem 1rem; border-radius:12px; font-weight:700; margin-bottom:1rem;
  }
</style>

<div class="form-shell">
  <h2 class="page-title">
    {% if view.object %}‚úèÔ∏è Edit Allocation{% else %}üìã New Allocation{% endif %}
  </h2>

  <form method="post" class="form-pane" novalidate>
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="alert-danger">{{ form.non_field_errors }}</div>
    {% endif %}

    <!-- Student -->
    <div class="field">
      <label for="{{ form.student.id_for_label|default:'id_student' }}">Student</label>
      {{ form.student }}
      {% if form.student.errors %}
        <div class="error">{{ form.student.errors }}</div>
      {% endif %}
    </div>

    <!-- Hostel -->
    <div class="field">
      <label for="{{ form.hostel.id_for_label|default:'id_hostel' }}">Hostel</label>
      {{ form.hostel }}
      {% if form.hostel.errors %}
        <div class="error">{{ form.hostel.errors }}</div>
      {% endif %}
    </div>

    <!-- Room -->
    <div class="field">
      <label for="{{ form.room.id_for_label|default:'id_room' }}">Room</label>
      {{ form.room }}
      {% if form.room.errors %}
        <div class="error">{{ form.room.errors }}</div>
      {% endif %}
    </div>

    <!-- Bed -->
    <div class="field">
      <label for="{{ form.bed.id_for_label|default:'id_bed' }}">Bed</label>
      {{ form.bed }}
      <div class="form-text">Only beds that are currently available are listed.</div>
      {% if form.bed.errors %}
        <div class="error">{{ form.bed.errors }}</div>
      {% endif %}
    </div>

    <!-- Status -->
    <div class="field">
      <label for="{{ form.status.id_for_label|default:'id_status' }}">Status</label>
      {{ form.status }}
      {% if form.status.errors %}
        <div class="error">{{ form.status.errors }}</div>
      {% endif %}
    </div>

    <!-- Start Date -->
    <div class="field">
      <label for="{{ form.start_date.id_for_label|default:'id_start_date' }}">Start Date</label>
      {{ form.start_date }}
      {% if form.start_date.errors %}
        <div class="error">{{ form.start_date.errors }}</div>
      {% endif %}
    </div>

    <!-- End Date -->
    <div class="field">
      <label for="{{ form.end_date.id_for_label|default:'id_end_date' }}">End Date</label>
      {{ form.end_date }}
      {% if form.end_date.errors %}
        <div class="error">{{ form.end_date.errors }}</div>
      {% endif %}
    </div>

    <!-- Notes -->
    <div class="field">
      <label for="{{ form.notes.id_for_label|default:'id_notes' }}">Notes</label>
      {{ form.notes }}
      {% if form.notes.errors %}
        <div class="error">{{ form.notes.errors }}</div>
      {% endif %}
    </div>

    <div class="actions">
      <button type="submit" class="btnx btn-primaryx">Save Allocation</button>
      <a href="{% url 'hostel:allocation_list' %}" class="btnx btn-cancelx">Cancel</a>
    </div>
  </form>
</div>

<!-- Link external JS for voice input -->
<script src="{% static 'js/script.js' %}"></script>
{% endblock %}

{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container">
    <h2>{% if edit %}Edit{% else %}Add{% endif %} Student</h2>
    
    {% if messages %}
    <div class="alert-container">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
        {% csrf_token %}
        
        {% if form.errors %}
        <div class="alert alert-danger">
            <strong>Error!</strong> Please correct the following errors:
            <ul>
                {% for field in form %}
                    {% for error in field.errors %}
                        <li>{{ field.label }}: {{ error }}</li>
                    {% endfor %}
                {% endfor %}
                {% for error in form.non_field_errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        
        <div class="row">
            <!-- Personal Information -->
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header">Personal Information</div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="id_name">Full Name*</label>
                            {{ form.name }}
                        </div>
                        <div class="form-group">
                            <label for="id_gender">Gender*</label>
                            {{ form.gender }}
                        </div>
                        <div class="form-group">
                            <label for="id_dob">Date of Birth*</label>
                            {{ form.dob }}
                        </div>
                        <div class="form-group">
                            <label for="id_photo">Photo</label>
                            {{ form.photo }}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Academic Information -->
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header">Academic Information</div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="id_admission_number">Admission Number</label>
                            {{ form.admission_number }}
                        </div>
                        <div class="form-group">
                            <label for="id_roll_no">Roll Number</label>
                            {{ form.roll_no }}
                        </div>
                        <div class="form-group">
                            <label for="id_class_section">Class & Section*</label>
                            {{ form.class_section }}
                        </div>
                        <div class="form-group">
                            <label for="id_academic_year">Academic Year*</label>
                            {{ form.academic_year }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Family Information -->
        <div class="card mb-4">
            <div class="card-header">Family Information</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="id_father_name">Father's Name*</label>
                            {{ form.father_name }}
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="id_mother_name">Mother's Name*</label>
                            {{ form.mother_name }}
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="id_guardian_name">Guardian's Name</label>
                            {{ form.guardian_name }}
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="id_guardian_relation">Guardian Relation</label>
                    {{ form.guardian_relation }}
                </div>
            </div>
        </div>
        
        <!-- Contact Information -->
        <div class="card mb-4">
            <div class="card-header">Contact Information</div>
            <div class="card-body">
                <div class="form-group">
                    <label for="id_address">Address*</label>
                    {{ form.address }}
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="id_contact_number">Contact Number*</label>
                            {{ form.contact_number }}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="id_email">Email</label>
                            {{ form.email }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Additional Information -->
        <div class="card mb-4">
            <div class="card-header">Additional Information</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="id_aadhaar_number">Aadhaar Number</label>
                            {{ form.aadhaar_number }}
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="id_religion">Religion</label>
                            {{ form.religion }}
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="id_community">Community</label>
                            {{ form.community }}
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label for="id_blood_group">Blood Group</label>
                            {{ form.blood_group }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Student Category and Transport -->
        <div class="card mb-4">
            <div class="card-header">Student Category & Transport</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="id_student_category">Student Category</label>
                            {{ form.student_category }}
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="id_transport_mode">Transport Mode</label>
                            {{ form.transport_mode }}
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="id_pickup_point">Pickup Point</label>
                            {{ form.pickup_point }}
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="id_bus_route_number">Bus Route Number</label>
                            {{ form.bus_route_number }}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="id_rfid_code">RFID Code</label>
                            {{ form.rfid_code }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Hostel Information -->
        <div class="card mb-4">
            <div class="card-header">Hostel Information</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="id_hostel_name">Hostel Name</label>
                            {{ form.hostel_name }}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="id_room_number">Room Number</label>
                            {{ form.room_number }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Previous School Information -->
        <div class="card mb-4">
            <div class="card-header">Previous School Information</div>
            <div class="card-body">
                <div class="form-group">
                    <label for="id_previous_school">Previous School</label>
                    {{ form.previous_school }}
                </div>
                <div class="form-group">
                    <label for="id_transfer_certificate_number">Transfer Certificate Number</label>
                    {{ form.transfer_certificate_number }}
                </div>
            </div>
        </div>
        
        <!-- Status Information -->
        <div class="card mb-4">
            <div class="card-header">Status Information</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="id_status">Status</label>
                            {{ form.status }}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="id_date_of_leaving">Date of Leaving</label>
                            {{ form.date_of_leaving }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <button type="submit" class="btn btn-primary">Save</button>
            <a href="{% url 'student_list' %}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<!-- Add Bootstrap JS and jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
$(document).ready(function() {
    // Add form validation
    $('form').submit(function(e) {
        let valid = true;
        $('[required]').each(function() {
            if ($(this).val() === '') {
                $(this).addClass('is-invalid');
                valid = false;
            } else {
                $(this).removeClass('is-invalid');
            }
        });
        
        if (!valid) {
            e.preventDefault();
            alert('Please fill in all required fields.');
        }
    });
    
    // Handle date fields
    $('input[type="date"]').attr('max', new Date().toISOString().split('T')[0]);
});
</script>
{% endblock %}